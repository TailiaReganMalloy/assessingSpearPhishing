<% layout('layout') %>
<% title = 'Dashboard' %>
<div class="dashboard">
  <h2>Welcome, <%= user.username %></h2>
  <a href="/logout" class="logout-btn">Logout</a>
  <% if (error) { %>
    <p class="error"><%= error %></p>
  <% } %>
  <div class="message-form">
    <h3>Send a Message</h3>
    <form action="/send" method="POST">
      <div class="form-group">
        <label for="recipientUsername">To:</label>
        <select id="recipientUsername" name="recipientUsername" required>
          <option value="">Select a user</option>
          <% users.forEach(user => { %>
            <option value="<%= user.username %>"><%= user.username %></option>
          <% }) %>
        </select>
      </div>
      <div class="form-group">
        <label for="content">Message:</label>
        <textarea id="content" name="content" required></textarea>
      </div>
      <button type="submit" class="send-btn">Send</button>
    </form>
  </div>
  <div class="messages">
    <h3>Received Messages</h3>
    <% if (messages.length === 0) { %>
      <p>No messages received.</p>
    <% } else { %>
      <ul>
        <% messages.forEach(message => { %>
          <li class="<%= message.read ? 'read' : 'unread' %>">
            <strong>From: <%= message.sender.username %></strong> - <%= message.content %>
            <small><%= message.createdAt.toLocaleString() %></small>
          </li>
        <% }) %>
      </ul>
    <% } %>
  </div>
</div>