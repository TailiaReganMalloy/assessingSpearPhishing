<%- include partials/header %>

<div class="container mx-auto p-4">
  <h1>Secure Messaging Dashboard</h1>
  <p>Welcome, <strong><%= user.email %></strong></p>
  <form action="/auth/logout" method="POST">
    <button type="submit" class="btn btn-primary">Logout</button>
  </form>

  <div class="messages mt-4">
    <h2>Select User to Message</h2>
    <ul>
      <% users.forEach(user => { %>
        <li><a href="/messages/<%= user._id %>"><%= user.email %></a></li>
      <% }) %>
    </ul>

    <% if (selectedUser) { %>
      <h3>Conversation with <%= selectedUser.email %></h3>
      <div class="message-list">
        <% messages.forEach(msg => { %>
          <div class="<%= msg.sender.equals(user._id) ? 'sent' : 'received' %>">
            <p><%= msg.content %></p>
            <span><%= msg.createdAt.toLocaleString() %></span>
          </div>
        <% }) %>
      </div>

      <form action="/messages" method="POST" class="mt-4">
        <input type="hidden" name="receiverId" value="<%= selectedUser._id %>">
        <textarea name="content" class="form-control" required></textarea>
        <button type="submit" class="btn btn-primary mt-2">Send</button>
      </form>
    <% } %>
  </div>
</div>

<%- include partials/footer %>
