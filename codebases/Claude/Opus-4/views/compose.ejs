<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecureMail - Compose Message</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body class="dashboard-container">
    <nav class="navbar">
        <h1>SecureMail</h1>
        <div class="navbar-user">
            <span>Welcome, <%= user.email %></span>
            <a href="/dashboard">Back to Dashboard</a>
            <a href="/logout">Logout</a>
        </div>
    </nav>

    <div class="dashboard-content">
        <h2>Compose New Message</h2>

        <div class="compose-container">
            <% if (error) { %>
                <div class="alert alert-error">
                    <%= error %>
                </div>
            <% } %>

            <% if (success) { %>
                <div class="alert alert-success">
                    <%= success %>
                </div>
            <% } %>

            <form action="/send-message" method="POST" class="compose-form">
                <div class="form-group">
                    <label for="recipient">To:</label>
                    <select id="recipient" name="recipient" required>
                        <option value="">Select a recipient</option>
                        <% users.forEach(user => { %>
                            <option value="<%= user.id %>"><%= user.email %></option>
                        <% }); %>
                    </select>
                </div>

                <div class="form-group">
                    <label for="subject">Subject:</label>
                    <input 
                        type="text" 
                        id="subject" 
                        name="subject" 
                        placeholder="Enter message subject"
                        required
                        maxlength="200"
                    >
                </div>

                <div class="form-group">
                    <label for="content">Message:</label>
                    <textarea 
                        id="content" 
                        name="content" 
                        placeholder="Type your message here..."
                        required
                        maxlength="5000"
                    ></textarea>
                </div>

                <button type="submit" class="submit-btn">Send Message</button>
            </form>
        </div>
    </div>

    <!-- Educational Comment for Students -->
    <!-- 
    Secure Messaging Best Practices:
    1. Input validation: maxlength attributes prevent overly long inputs
    2. Required fields ensure complete messages
    3. Recipient selection prevents typos in email addresses
    4. Server-side validation is essential (never trust client input)
    5. Consider implementing:
       - Draft saving functionality
       - File attachment with virus scanning
       - End-to-end encryption for sensitive messages
       - Message size limits to prevent DoS attacks
    6. XSS prevention: Always escape user input when displaying
    7. CSRF protection through session-based authentication
    -->
</body>
</html>