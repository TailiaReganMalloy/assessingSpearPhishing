<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlueMind - Inbox</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body class="app-page">
    <%- include('partials/header') %>

    <div class="app-container">
        <%- include('partials/sidebar') %>

        <main class="main-content">
            <div class="content-header">
                <h1>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="header-icon">
                        <path d="M22 12h-6l-2 3h-4l-2-3H2"/>
                        <path d="M5.45 5.11L2 12v6a2 2 0 002 2h16a2 2 0 002-2v-6l-3.45-6.89A2 2 0 0016.76 4H7.24a2 2 0 00-1.79 1.11z"/>
                    </svg>
                    Inbox
                    <% if (unreadCount > 0) { %>
                        <span class="unread-badge"><%= unreadCount %></span>
                    <% } %>
                </h1>
                <a href="/messages/compose" class="btn-compose">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 5v14M5 12h14"/>
                    </svg>
                    Compose
                </a>
            </div>

            <div class="message-list">
                <% if (messages.length === 0) { %>
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" class="empty-icon">
                            <rect x="2" y="4" width="20" height="16" rx="2"/>
                            <path d="M22 6L12 13L2 6"/>
                        </svg>
                        <h3>No messages yet</h3>
                        <p>Your inbox is empty. Start a conversation!</p>
                        <a href="/messages/compose" class="btn-primary">Send a Message</a>
                    </div>
                <% } else { %>
                    <table class="messages-table">
                        <thead>
                            <tr>
                                <th class="col-status"></th>
                                <th class="col-sender">From</th>
                                <th class="col-subject">Subject</th>
                                <th class="col-date">Date</th>
                                <th class="col-actions">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% messages.forEach(function(msg) { %>
                                <tr class="<%= msg.is_read ? 'read' : 'unread' %>">
                                    <td class="col-status">
                                        <% if (!msg.is_read) { %>
                                            <span class="unread-dot" title="Unread"></span>
                                        <% } %>
                                    </td>
                                    <td class="col-sender">
                                        <span class="sender-name"><%= msg.sender_name %></span>
                                        <span class="sender-email"><%= msg.sender_email %></span>
                                    </td>
                                    <td class="col-subject">
                                        <a href="/messages/view/<%= msg.id %>"><%= msg.subject %></a>
                                    </td>
                                    <td class="col-date">
                                        <%= new Date(msg.created_at).toLocaleDateString('en-US', { 
                                            month: 'short', 
                                            day: 'numeric',
                                            hour: '2-digit',
                                            minute: '2-digit'
                                        }) %>
                                    </td>
                                    <td class="col-actions">
                                        <form action="/messages/delete/<%= msg.id %>" method="POST" class="delete-form">
                                            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                                            <button type="submit" class="btn-delete" title="Delete" onclick="return confirm('Delete this message?')">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                                                </svg>
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            <% }); %>
                        </tbody>
                    </table>
                <% } %>
            </div>
        </main>
    </div>

    <%- include('partials/footer') %>
</body>
</html>
