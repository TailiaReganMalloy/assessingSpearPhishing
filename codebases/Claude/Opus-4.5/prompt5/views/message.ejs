<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlueMind Security Demo - Message</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <div class="dashboard-header">
            <div>
                <h1 class="dashboard-title">
                    <a href="/dashboard" style="color: white; text-decoration: none; display: flex; align-items: center; gap: 12px;">
                        <div class="logo-icon" style="width: 32px; height: 32px;">
                            <div style="width: 16px; height: 16px; border: 2px solid white; border-radius: 50%; border-top-color: transparent; border-right-color: transparent;"></div>
                        </div>
                        BlueMind - Message
                    </a>
                </h1>
            </div>
            <div class="user-info">
                <a href="/dashboard" style="color: rgba(255,255,255,0.8); text-decoration: none; margin-right: 16px;">‚Üê Back to Dashboard</a>
                <form method="POST" action="/logout" style="display: inline;">
                    <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
                    <button type="submit" class="logout-btn">Logout</button>
                </form>
            </div>
        </div>

        <!-- Message Content -->
        <div class="dashboard-content">
            <div style="max-width: 800px; margin: 0 auto;">
                <div style="background: white; border: 1px solid #e2e8f0; border-radius: 8px; overflow: hidden;">
                    <!-- Message Header -->
                    <div style="background: #f8fafc; border-bottom: 1px solid #e2e8f0; padding: 24px 32px;">
                        <h1 style="margin: 0 0 16px 0; color: #1f2937; font-size: 24px; word-break: break-word;">
                            <%= message.subject %>
                        </h1>
                        
                        <div style="display: flex; flex-wrap: wrap; gap: 24px; color: #64748b; font-size: 14px;">
                            <div>
                                <strong style="color: #374151;">From:</strong> <%= message.sender_email %>
                            </div>
                            <div>
                                <strong style="color: #374151;">To:</strong> <%= message.recipient_email %>
                            </div>
                            <div>
                                <strong style="color: #374151;">Date:</strong> 
                                <%= new Date(message.created_at).toLocaleDateString() %> 
                                <%= new Date(message.created_at).toLocaleTimeString() %>
                            </div>
                            <% if (message.read_at && message.recipient_id === currentUserId) { %>
                                <div>
                                    <strong style="color: #374151;">Read:</strong> 
                                    <%= new Date(message.read_at).toLocaleDateString() %> 
                                    <%= new Date(message.read_at).toLocaleTimeString() %>
                                </div>
                            <% } %>
                        </div>

                        <!-- Status Indicator -->
                        <div style="margin-top: 12px;">
                            <% if (message.recipient_id === currentUserId) { %>
                                <% if (message.read_at) { %>
                                    <span style="background: #dcfce7; color: #166534; padding: 4px 8px; border-radius: 4px; font-size: 12px;">
                                        ‚úì Read
                                    </span>
                                <% } else { %>
                                    <span style="background: #dbeafe; color: #1d4ed8; padding: 4px 8px; border-radius: 4px; font-size: 12px;">
                                        üì¨ New
                                    </span>
                                <% } %>
                            <% } else { %>
                                <span style="background: #f3f4f6; color: #374151; padding: 4px 8px; border-radius: 4px; font-size: 12px;">
                                    üì§ Sent
                                </span>
                            <% } %>
                        </div>
                    </div>

                    <!-- Message Body -->
                    <div style="padding: 32px;">
                        <div style="line-height: 1.6; color: #374151; white-space: pre-wrap; word-break: break-word;">
                            <%- message.body %>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div style="background: #f8fafc; border-top: 1px solid #e2e8f0; padding: 20px 32px; display: flex; gap: 12px; justify-content: space-between; align-items: center;">
                        <div>
                            <a href="/inbox" style="color: #3b82f6; text-decoration: none; font-size: 14px;">‚Üê Back to Inbox</a>
                            <span style="color: #d1d5db; margin: 0 8px;">|</span>
                            <a href="/sent" style="color: #3b82f6; text-decoration: none; font-size: 14px;">View Sent Messages</a>
                        </div>
                        
                        <% if (message.sender_id !== currentUserId) { %>
                            <a href="/compose?reply=<%= message.id %>" class="btn-primary">
                                Reply
                            </a>
                        <% } %>
                    </div>
                </div>

                <!-- Security Information -->
                <div style="background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 8px; padding: 20px; margin-top: 20px;">
                    <h3 style="margin: 0 0 12px 0; color: #1d4ed8; display: flex; align-items: center; gap: 8px;">
                        <svg style="width: 20px; height: 20px;" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Message Security Information
                    </h3>
                    <div style="color: #1e40af; font-size: 14px; line-height: 1.5;">
                        <p style="margin: 4px 0;"><strong>Content Security:</strong> This message content has been sanitized to prevent XSS attacks</p>
                        <p style="margin: 4px 0;"><strong>Access Control:</strong> Only sender and recipient can view this message</p>
                        <p style="margin: 4px 0;"><strong>Message ID:</strong> <%= message.id %> (for educational tracking purposes)</p>
                        <% if (message.read_at && message.recipient_id === currentUserId) { %>
                            <p style="margin: 4px 0;"><strong>Read Tracking:</strong> Message marked as read when viewed</p>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>