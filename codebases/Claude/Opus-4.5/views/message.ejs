<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlueMind - <%= message.subject %></title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body class="app-page">
    <%- include('partials/header') %>

    <div class="app-container">
        <%- include('partials/sidebar') %>

        <main class="main-content">
            <div class="content-header">
                <a href="/inbox" class="back-link">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="19" y1="12" x2="5" y2="12"/>
                        <polyline points="12 19 5 12 12 5"/>
                    </svg>
                    Back to Inbox
                </a>
            </div>

            <article class="message-view">
                <header class="message-header">
                    <h1 class="message-subject"><%= message.subject %></h1>
                    <div class="message-meta">
                        <div class="meta-row">
                            <span class="meta-label">From:</span>
                            <span class="meta-value">
                                <strong><%= message.sender_name %></strong>
                                &lt;<%= message.sender_email %>&gt;
                            </span>
                        </div>
                        <div class="meta-row">
                            <span class="meta-label">To:</span>
                            <span class="meta-value">
                                <strong><%= message.recipient_name %></strong>
                                &lt;<%= message.recipient_email %>&gt;
                            </span>
                        </div>
                        <div class="meta-row">
                            <span class="meta-label">Date:</span>
                            <span class="meta-value">
                                <%= new Date(message.created_at).toLocaleDateString('en-US', { 
                                    weekday: 'long',
                                    year: 'numeric',
                                    month: 'long', 
                                    day: 'numeric',
                                    hour: '2-digit',
                                    minute: '2-digit'
                                }) %>
                            </span>
                        </div>
                    </div>
                </header>

                <div class="message-body">
                    <pre><%= message.body %></pre>
                </div>

                <footer class="message-actions">
                    <% if (message.sender_id !== user.id) { %>
                        <a href="/messages/compose?replyTo=<%= encodeURIComponent(message.sender_email) %>&subject=<%= encodeURIComponent('Re: ' + message.subject) %>" class="btn-reply">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9 17 4 12 9 7"/>
                                <path d="M20 18v-2a4 4 0 00-4-4H4"/>
                            </svg>
                            Reply
                        </a>
                    <% } %>
                    <form action="/messages/delete/<%= message.id %>" method="POST" class="delete-form inline">
                        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                        <button type="submit" class="btn-delete-msg" onclick="return confirm('Are you sure you want to delete this message?')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                            </svg>
                            Delete
                        </button>
                    </form>
                </footer>
            </article>
        </main>
    </div>

    <%- include('partials/footer') %>
</body>
</html>
